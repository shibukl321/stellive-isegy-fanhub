<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ìŠ¤í…”ë¼ì´ë¸Œ & ì´ì„¸ê³„ì•„ì´ëŒ íŒ¬ í—ˆë¸Œ (ë³µêµ¬íŒ v9.1C)</title>
  <meta name="color-scheme" content="dark light">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script defer src="https://accounts.google.com/gsi/client"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{
      --bg:#0e1117; --surface:#111827; --elev:#0c1220; --stroke:#253046;
      --text:#eaeef7; --muted:#a7b1c6; --brand:#8b8fff; --brand-2:#ff7dbc;
      --ok:#64d2b3; --warn:#ffcc66; --bad:#ff7d7d; --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font-family: Pretendard, system-ui, -apple-system, 'Noto Sans KR', Segoe UI, Roboto, sans-serif;}
    a{color:var(--brand);text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:1180px;margin:0 auto;padding:0 16px}
    header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,rgba(7,10,16,.9),rgba(7,10,16,.35),rgba(7,10,16,0));
      border-bottom:1px solid var(--stroke);backdrop-filter:saturate(1.1) blur(10px)}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
    .brand .badge{border:1px solid var(--stroke);padding:.25rem .6rem;border-radius:999px;color:var(--muted);font-size:.85rem;background:#0b1322}
    .tabs{display:flex;gap:6px;flex-wrap:wrap}
    .tabs button{border:1px solid var(--stroke);background:#0c1425;color:var(--text);
      padding:.5rem .8rem;border-radius:12px;cursor:pointer}
    .tabs button.active{background:var(--brand);color:#101218;border-color:transparent}
    .right{display:flex;gap:8px;align-items:center}
    .btn{border:1px solid var(--stroke);background:#0c1425;color:var(--text);padding:.5rem .7rem;border-radius:10px;cursor:pointer}
    .btn.primary{background:var(--brand);border-color:transparent;color:#111}
    .btn.ghost{background:transparent}
    .pill{display:inline-block;border:1px solid var(--stroke);border-radius:999px;padding:.25rem .6rem;color:var(--muted);background:#0b1322}
    .muted{color:var(--muted)}
    main{display:grid;gap:14px}
    section{border:1px solid var(--stroke);border-radius:var(--radius);padding:14px;background:linear-gradient(180deg,#101626,rgba(255,255,255,.03))}
    h1,h2,h3{margin:.2rem 0 .6rem 0}
    h1{font-size:1.6rem}
    h2{font-size:1.25rem}
    .hide{display:none}

    /* HERO (í˜„ì¬ ë²„ì „ì—ì„œ ë§ˆìŒì— ë“¤ì—ˆë˜ ë©”ì¸ í™”ë©´ ìŠ¤íƒ€ì¼ ìœ ì§€) */
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:12px;align-items:center}
    .hero .panel{border:1px solid var(--stroke);border-radius:14px;background:#0c1424;padding:12px}
    .hero .cta{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    @media(max-width:920px){.hero{grid-template-columns:1fr}}

    /* grids */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:10px}
    .card{border:1px solid var(--stroke);border-radius:12px;background:#0c1424;padding:10px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 10px}
    input,select,textarea{border:1px solid var(--stroke);background:#0c1425;color:var(--text);padding:.5rem .6rem;border-radius:10px;width:100%}
    textarea{min-height:84px;resize:vertical}
    .tool{display:flex;gap:8px;flex-wrap:wrap}
    .kbar{display:flex;gap:6px;align-items:center;flex-wrap:wrap}

    /* list */
    .list{display:grid;gap:6px}
    .list li{display:flex;align-items:center;justify-content:space-between;gap:8px;border:1px solid var(--stroke);background:#0c1424;padding:8px;border-radius:10px}

    /* gallery */
    .gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
    .gallery figure{border:1px solid var(--stroke);border-radius:12px;background:#0c1424;padding:10px}
    .gallery img{border-radius:10px}

    /* chart wrap */
    .chart-wrap{border:1px solid var(--stroke);border-radius:12px;background:#0c1424;padding:10px}

    footer{padding:30px 0;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <span>íŒ¬ í—ˆë¸Œ</span>
        <span class="badge">STELLIVE & ISEGYE</span>
      </div>

      <nav class="tabs">
        <button data-tab="home" class="active">í™ˆ</button>
        <button data-tab="members">ë©¤ë²„</button>
        <button data-tab="favorites">ìµœì• </button>
        <button data-tab="fanart">íŒ¬ì•„íŠ¸</button>
        <button data-tab="cover">ì»¤ë²„ê³¡</button>
        <button data-tab="diary">ë•ì§ˆ ì¼ê¸°</button>
        <button data-tab="confess">ìµëª… ê³ ë°±í•¨</button>
        <button data-tab="vote">íˆ¬í‘œ</button>
      </nav>

      <div class="right">
        <button id="themeBtn" class="btn">ğŸŒ—</button>
        <span id="userBadge" class="pill">ë¡œê·¸ì•„ì›ƒ ìƒíƒœ</span>
        <div id="signinBtn" class="btn primary">Google ë¡œê·¸ì¸</div>
        <button id="adminBtn" class="btn hide">âš™ï¸ ì„¤ì •</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- HOME (í˜„ì¬ ë©”ì¸ ìœ ì§€) -->
    <section id="home" class="hero">
      <div>
        <span class="pill">ë³µì›íŒ v9.1C</span>
        <h1>ìŠ¤í…”ë¼ì´ë¸Œ & ì´ì„¸ê³„ì•„ì´ëŒ â€” íŒ¬ í—ˆë¸Œ</h1>
        <p class="muted">ì´ì „ ë²„ì „ ê¸°ëŠ¥ì„ ë˜ì‚´ë¦¬ê³ , í˜„ì¬ ë§ˆìŒì— ë“œëŠ” ë©”ì¸(íˆì–´ë¡œ) ë””ìì¸ë§Œ ìœ ì§€í•œ í•˜ì´ë¸Œë¦¬ë“œì…ë‹ˆë‹¤.</p>
        <div class="cta">
          <button class="btn primary" onclick="switchTab('members')">ë©¤ë²„ ë³´ê¸°</button>
          <button class="btn" onclick="switchTab('favorites')">ìµœì•  ëª¨ì•„ë³´ê¸°</button>
          <button class="btn" onclick="switchTab('fanart')">íŒ¬ì•„íŠ¸</button>
          <button class="btn" onclick="switchTab('cover')">ì»¤ë²„ê³¡</button>
          <button class="btn" onclick="switchTab('vote')">íˆ¬í‘œ</button>
        </div>
      </div>
      <div class="panel">
        <h2>ì•Œë¦¼ & ì‚¬ìš©ë²•</h2>
        <ul class="muted">
          <li>Google ë¡œê·¸ì¸ ì‹œ ê´€ë¦¬ìë¼ë©´ íŒ¬ì•„íŠ¸ ê³ ì •/ì—…ë¡œë“œ/íŠ¸ìœ— ì¶”ê°€ ê°€ëŠ¥</li>
          <li>ìµœì• ëŠ” ì—¬ëŸ¬ ëª… ì§€ì • â†’ â€˜ìµœì• â€™ íƒ­ì—ì„œ í•œ ë²ˆì— ë³´ê¸°</li>
          <li>íˆ¬í‘œëŠ” ì›” 1í‘œ(ë¸Œë¼ìš°ì € ê¸°ì¤€)</li>
          <li>íŒ¬ì•„íŠ¸ ì´ë¯¸ì§€ëŠ” X í”„ë¡ì‹œê°€ ì—†ìœ¼ë©´ íƒ€ì„ë¼ì¸ í´ë°±</li>
        </ul>
      </div>
    </section>

    <!-- MEMBERS -->
    <section id="members" class="hide">
      <h2>ë©¤ë²„ ì†Œê°œ</h2>
      <div class="controls">
        <select id="groupSel">
          <option value="ALL">ì „ì²´</option>
          <option value="STELLIVE">STELLIVE</option>
          <option value="ISEGYE">ì´ì„¸ê³„ì•„ì´ëŒ</option>
        </select>
        <input id="search" placeholder="ì´ë¦„/íƒœê·¸ ê²€ìƒ‰"/>
        <div class="kbar">
          <label class="pill"><input type="checkbox" id="onlyFav"> ìµœì• ë§Œ</label>
          <button class="btn" onclick="location.hash='#fanart'">íŒ¬ì•„íŠ¸</button>
          <button class="btn" onclick="location.hash='#cover'">ì»¤ë²„ê³¡</button>
        </div>
      </div>
      <div id="memberGrid" class="grid"></div>
    </section>

    <!-- FAVORITES -->
    <section id="favorites" class="hide">
      <h2>ìµœì• (ì—¬ëŸ¬ ëª…) â€” í•œ ê³³ì—ì„œ</h2>
      <div id="favWrap" class="grid"></div>
      <p class="muted">ì¹´ë“œì˜ í•˜íŠ¸ë¥¼ ëˆŒëŸ¬ ìµœì• ë¥¼ ì¶”ê°€/ì‚­ì œí•  ìˆ˜ ìˆì–´ìš”.</p>
    </section>

    <!-- FANART -->
    <section id="fanart" class="hide">
      <h2>íŒ¬ì•„íŠ¸ ê°¤ëŸ¬ë¦¬</h2>
      <div class="controls">
        <select id="fanGroup">
          <option value="STELLIVE">STELLIVE</option>
          <option value="ISEGYE">ì´ì„¸ê³„ì•„ì´ëŒ</option>
        </select>
        <select id="fanMember"></select>
        <button class="btn" id="reloadFan">ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn hide" id="adminToggle">ğŸ› ï¸ ê´€ë¦¬ì</button>
      </div>
      <div id="adminPanel" class="card hide">
        <h3>ê´€ë¦¬ì íŒ¨ë„</h3>
        <div class="controls">
          <input id="xProxy" placeholder="X í”„ë¡ì‹œ ì£¼ì†Œ (ì˜ˆ: https://your-worker.workers.dev)">
          <button class="btn" id="saveProxy">í”„ë¡ì‹œ ì €ì¥</button>
        </div>
        <div class="controls">
          <input id="pinImage" placeholder="ì˜¤ëŠ˜ ê³ ì • ì´ë¯¸ì§€ URL">
          <input id="pinLink" placeholder="ì›ë³¸ ë§í¬(ì„ íƒ)">
          <button class="btn" id="savePin">ì˜¤ëŠ˜ ê³ ì • ë“±ë¡</button>
          <button class="btn" id="clearPin">í•´ì œ</button>
        </div>
        <div class="controls">
          <input type="file" id="uploadImg" accept="image/*">
          <button class="btn" id="useUpload">ìˆ˜ë™ ì—…ë¡œë“œ â†’ ì „ì‹œ</button>
          <input id="tweetUrl" placeholder="íŠ¸ìœ— URL (https://x.com/...)">
          <button class="btn" id="addTweet">íŠ¸ìœ— ì„ë² ë“œ</button>
        </div>
      </div>
      <div id="fanGallery" class="gallery"></div>
      <p class="muted">â€» í”„ë¡ì‹œ ë¯¸ì„¤ì • ì‹œ, ì´ë¯¸ì§€ 3ì¥ ëœë¤ ì „ì‹œ ëŒ€ì‹  í•´ë‹¹ íƒœê·¸ì˜ íƒ€ì„ë¼ì¸ìœ¼ë¡œ ì´ë™ ë§í¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
    </section>

    <!-- COVER -->
    <section id="cover" class="hide">
      <h2>ì»¤ë²„ê³¡ ì¬ìƒëª©ë¡</h2>
      <div class="controls">
        <select id="coverSel"></select>
      </div>
      <div id="coverWrap" class="card"></div>
    </section>

    <!-- DIARY -->
    <section id="diary" class="hide">
      <h2>ë•ì§ˆ ì¼ê¸°</h2>
      <div class="controls">
        <textarea id="diaryText" placeholder="ì˜¤ëŠ˜ì˜ ë•ì§ˆ ê¸°ë¡..."></textarea>
        <button class="btn primary" id="addDiary">ì¶”ê°€</button>
      </div>
      <ul id="diaryList" class="list"></ul>
    </section>

    <!-- CONFESS -->
    <section id="confess" class="hide">
      <h2>ìµëª… ê³ ë°±í•¨</h2>
      <div class="controls">
        <textarea id="confText" placeholder="ì‘ì›/ê³ ë°± ë©”ì‹œì§€... (ìµëª…)"></textarea>
        <button class="btn primary" id="addConf">ì¶”ê°€</button>
      </div>
      <ul id="confList" class="list"></ul>
    </section>

    <!-- VOTE -->
    <section id="vote" class="hide">
      <h2>ì›”ê°„ íˆ¬í‘œ</h2>
      <div class="controls">
        <select id="voteScope">
          <option value="ALL">ì „ì²´</option>
          <option value="STELLIVE">STELLIVE</option>
          <option value="ISEGYE">ì´ì„¸ê³„ì•„ì´ëŒ</option>
        </select>
        <select id="voteSel"></select>
        <button class="btn primary" id="doVote">íˆ¬í‘œ</button>
        <button class="btn" id="myVote">ë‚´ íˆ¬í‘œ í™•ì¸</button>
      </div>
      <div class="chart-wrap">
        <canvas id="voteChart" height="220"></canvas>
      </div>
      <p class="muted">â€» 1ì¸ 1í‘œ/ì›”(ë¸Œë¼ìš°ì € ê¸°ì¤€).</p>
    </section>
  </main>

  <footer class="container">
    <p>Â© Fan-made hub. ì´ë¯¸ì§€/ì˜ìƒì€ ê° ì €ì‘ê¶Œìì—ê²Œ ê·€ì†ë©ë‹ˆë‹¤.</p>
  </footer>

  <script>
    /* ---------- UTIL ---------- */
    const $$ = (s)=>Array.from(document.querySelectorAll(s));
    const $ = (s)=>document.querySelector(s);
    function switchTab(id){
      $$('.tabs button').forEach(b=>b.classList.toggle('active', b.dataset.tab===id));
      $$('main > section').forEach(sec=>sec.classList.toggle('hide', sec.id!==id));
      location.hash = '#'+id;
      if(id==='members') renderMembers();
      if(id==='favorites') renderFav();
      if(id==='fanart') renderFanartUI();
      if(id==='cover') { populateCoverSel(); renderCover(); }
      if(id==='vote') { populateVoteSel(); renderVoteChart(); }
      if(id==='diary') renderDiary();
      if(id==='confess') renderConf();
    }
    $$('.tabs button').forEach(btn=>btn.addEventListener('click',()=>switchTab(btn.dataset.tab)));
    window.addEventListener('hashchange', ()=>{
      const id = (location.hash||'#home').slice(1);
      const valid = ['home','members','favorites','fanart','cover','diary','confess','vote'];
      switchTab(valid.includes(id)?id:'home');
    });

    /* ---------- THEME ---------- */
    $('#themeBtn').addEventListener('click', ()=>{
      document.documentElement.classList.toggle('light');
    });

    /* ---------- CONFIG LOADER ---------- */
    let APP = { googleClientId:'', adminEmails:[], xProxyBase:'' };
    async function loadConfig(){
      try{
        const base = new URL('.', location.href).pathname.replace(/\/[^\/]*$/, '/');
        const cfgUrl = (base.endsWith('/')?base:base+'/') + 'config/app-config.json';
        const res = await fetch(cfgUrl, {cache:'no-cache'});
        if(!res.ok) throw new Error('config load fail');
        APP = await res.json();
      }catch(e){
        console.warn('Config load failed', e);
      }finally{
        setupGoogle();
        checkAdmin();
      }
    }

    /* ---------- GOOGLE SIGN-IN (GIS) ---------- */
    let USER = null;
    function setupGoogle(){
      const cid = APP.googleClientId;
      if(!cid){ $('#signinBtn').textContent='ë¡œê·¸ì¸ ë¶ˆê°€(ì„¤ì • í•„ìš”)'; return; }
      window.google?.accounts.id.initialize({
        client_id: cid,
        auto_select: false,
        callback: (resp)=>{
          // decode payload (without server verify; for client-only demo)
          try{
            const payload = JSON.parse(atob(resp.credential.split('.')[1]));
            USER = { email: (payload.email||'').toLowerCase(), name: payload.name, picture: payload.picture };
          }catch(e){ USER = { email:'', name:'', picture:'' }; }
          $('#userBadge').textContent = USER?.email || 'ë¡œê·¸ì¸ë¨';
          $('#signinBtn').classList.add('hide');
          checkAdmin();
        }
      });
      window.google?.accounts.id.renderButton($('#signinBtn'), { theme:'outline', size:'medium' });
      $('#signinBtn').classList.remove('hide');
    }
    function checkAdmin(){
      const isAdmin = USER && APP.adminEmails.map(e=>e.toLowerCase()).includes(USER.email||'');
      $('#adminBtn').classList.toggle('hide', !isAdmin);
      $('#adminToggle')?.classList.toggle('hide', !isAdmin);
    }
    $('#adminBtn').addEventListener('click', ()=>{
      switchTab('fanart');
      $('#adminPanel').classList.toggle('hide');
    });

    /* ---------- DATA ---------- */
    const MEMBERS = [
      // STELLIVE
      {id:'airi',     name:'ì•„ì´ë¦¬ ì¹¸ë‚˜', group:'STELLIVE', stream:'https://www.youtube.com/@hebich/streams', tags:['Kanart']},
      {id:'ayatsuno', name:'ì•„ì•¼ì¸ ë…¸ ìœ ë‹ˆ', group:'STELLIVE', stream:'https://chzzk.naver.com/45e71a76e949e16a34764deb962f9d9f', tags:['yunyart']},
      {id:'shirayuki',name:'ì‹œë¼ìœ í‚¤ íˆë‚˜', group:'STELLIVE', stream:'https://chzzk.naver.com/b044e3a3b9259246bc92e863e7d3f3b8', tags:['_hinart','shiroart']},
      {id:'neneko',   name:'ë„¤ë„¤ì½” ë§ˆì‹œë¡œ', group:'STELLIVE', stream:'https://chzzk.naver.com/4515b179f86b67b4981e16190817c580', tags:['shiroart']},
      {id:'akane',    name:'ì•„ì¹´ë„¤ ë¦¬ì œ', group:'STELLIVE', stream:'https://chzzk.naver.com/4325b1d5bbc321fad3042306646e2e50', tags:['Lize_art']},
      {id:'arahashi', name:'ì•„ë¼í•˜ì‹œ íƒ€ë¹„', group:'STELLIVE', stream:'https://chzzk.naver.com/a6c4ddb09cdb160478996007bff35296', tags:['Tabiart']},
      {id:'tenko',    name:'í…ì½” ì‹œë¶€í‚¤', group:'STELLIVE', stream:'https://chzzk.naver.com/64d76089fba26b180d9c9e48a32600d9', tags:['shibuki_art']},
      {id:'aokumo',   name:'ì•„ì˜¤ì¿ ëª¨ ë¦°', group:'STELLIVE', stream:'https://chzzk.naver.com/516937b5f85cbf2249ce31b0ad046b0f', tags:['kumorinart']},
      {id:'hanako',   name:'í•˜ë‚˜ì½” ë‚˜ë‚˜', group:'STELLIVE', stream:'https://chzzk.naver.com/4d812b586ff63f8a2946e64fa860bbf5', tags:['Nanart_']},
      {id:'yuzuha',   name:'ìœ ì¦ˆí•˜ ë¦¬ì½”', group:'STELLIVE', stream:'https://chzzk.naver.com/8fd39bb8de623317de90654718638b10', tags:['riko_art']},
      // ISEGYE
      {id:'jingburger',name:'ì§•ë²„ê±°', group:'ISEGYE', stream:'https://ch.sooplive.co.kr/jingburger1', tags:['ì§•ë²„ê±°']},
      {id:'aine',     name:'ì•„ì´ë„¤', group:'ISEGYE', stream:'https://ch.sooplive.co.kr/inehine', tags:['ì•„ì´ë„¤']},
      {id:'lilpa',    name:'ë¦´íŒŒ', group:'ISEGYE', stream:'https://ch.sooplive.co.kr/lilpa0309', tags:['ë¦´íŒŒ']},
      {id:'viichan',  name:'ë¹„ì±¤', group:'ISEGYE', stream:'https://ch.sooplive.co.kr/viichan6', tags:['ë¹„ì±¤']},
      {id:'jururu',   name:'ì£¼ë¥´ë¥´', group:'ISEGYE', stream:'https://ch.sooplive.co.kr/cotton1217', tags:['ì£¼ë¥´ë¥´']},
      {id:'gosegu',   name:'ê³ ì„¸êµ¬', group:'ISEGYE', stream:'https://ch.sooplive.co.kr/gosegu2', tags:['ê³ ì„¸êµ¬']},
    ];
    const PLAYLISTS = [
      // ST
      {member:'yuzuha',   label:'ë¦¬ì½”',   list:'PL_D2YrKeYY2UvRIw_SW3lQXzBDO7aBeii'},
      {member:'tenko',    label:'ë¶€í‚¤',   list:'PLKVNBOcsLJlVii-8YwoZTD3o4gh5CnIND'},
      {member:'hanako',   label:'ë‚˜ë‚˜',   list:'PLJWmDIpvwe7Cri29xtAyQXLC1RLwOChpA'},
      {member:'shirayuki',label:'íˆë‚˜',   list:'PLzdLDJsHzz2NiuwjyW6QgSck4PrwlSyOc'},
      {member:'airi',     label:'ì¹¸ë‚˜',   list:'PLOPBV2KAIYnt1NJ0QCkfCqMRc00lfcjFa'},
      {member:'akane',    label:'ë¦¬ì œ',   list:'PL-DHk0WpiRNSM5oI19ImJ8sSV65mnGseX'},
      {member:'ayatsuno', label:'ìœ ë‹ˆ',   list:'PL3HtH_xx9h_7ZGoZ9zMUQ-MPumwe21_cc'},
      {member:'arahashi', label:'íƒ€ë¹„',   list:'PLbIDsfX2JRA0oawGN209gpd_nz9IMvUlb'},
      {member:'neneko',   label:'ë§ˆì‹œë¡œ', list:'PLWwhuXFHGLvhgZZb5_rmQEMI1B0ysKJxG'},
      {member:'aokumo',   label:'ë¦°',     list:'PLSDRWR15h-o4uWNeoLv0upOUUGj12f-yU'},
      // IS
      {member:'gosegu',   label:'ê³ ì„¸êµ¬', list:'PLZNwpHxpI4EjDSv3v_HY7udxDEqj4C7PL'},
      {member:'jururu',   label:'ì£¼ë¥´ë¥´', list:'PLqE7uvTHaH31Wl8lCe3SYslZvoCnTD-JS'},
      {member:'viichan',  label:'ë¹„ì±¤',   list:'PLhaJuLneKo5FdYnMZ1Jc5BaV7y26KvmD1'},
      {member:'jingburger',label:'ì§•ë²„ê±°',list:'PLio0a5EPF6j099Af5uBaK6V25RtTvK4kq'},
      {member:'lilpa',    label:'ë¦´íŒŒ',   list:'PLLPGQs-RNQXnFl55WissjQylZbInOK81P'},
      {member:'aine',     label:'ì•„ì´ë„¤', list:'PLJWTWXJ7iqXctxVu1Fd3ZkF-WWD8kOzMb'},
    ].map(p=>({ ...p, url:`https://www.youtube.com/embed/videoseries?list=${p.list}`}));
    const TAGS = {
      STELLIVE:['Kanart','yunyart','_hinart','shiroart','Tabiart','Lize_art','kumorinart','Nanart_','riko_art','shibuki_art'],
      ISEGYE:['ê³ ì„¸êµ¬','ë¦´íŒŒ','ë¹„ì±¤','ì•„ì´ë„¤','ì£¼ë¥´ë¥´','ì§•ë²„ê±°']
    };

    /* ---------- STATE ---------- */
    const KEY = {
      fav: 'fh.favorites.v1',
      diary: 'fh.diary.v1',
      confess: 'fh.confess.v1',
      vote: (ym)=>`fh.vote.${ym}`,
      galleryPin: (tag,date)=>`fh.pin.${tag}.${date}`,
      config: 'fh.cfg.v1'
    };
    let favorites = JSON.parse(localStorage.getItem(KEY.fav)||'[]');

    /* ---------- MEMBERS ---------- */
    function heart(isOn){return isOn?'ğŸ’–':'ğŸ¤'}
    function isFav(id){return favorites.includes(id)}
    function toggleFav(id){
      if(isFav(id)) favorites = favorites.filter(x=>x!==id);
      else favorites.push(id);
      localStorage.setItem(KEY.fav, JSON.stringify(favorites));
      renderMembers(); renderFav();
    }
    function renderMembers(){
      const group = $('#groupSel').value;
      const q = ($('#search').value||'').trim().toLowerCase();
      const onlyFav = $('#onlyFav').checked;
      let list = MEMBERS.slice();
      if(group!=='ALL') list = list.filter(m=>m.group===group);
      if(q) list = list.filter(m=>m.name.toLowerCase().includes(q) || (m.tags||[]).join(',').toLowerCase().includes(q));
      if(onlyFav) list = list.filter(m=>favorites.includes(m.id));
      const grid = $('#memberGrid'); grid.innerHTML='';
      list.forEach(m=>{
        const el = document.createElement('div'); el.className='card';
        el.innerHTML = `
          <div class="row">
            <strong>${m.name}</strong>
            <span class="pill">${m.group==='STELLIVE'?'ST':'IS'}</span>
          </div>
          <div class="muted" style="margin:6px 0">#${(m.tags||[]).join(' #')}</div>
          <div class="row">
            <a class="btn primary" href="${m.stream}" target="_blank" rel="noopener">ì±„ë„ ë°©ë¬¸</a>
            <button class="btn" onclick="openCover('${m.id}')">ì»¤ë²„ê³¡</button>
            <button class="btn" onclick="toggleFav('${m.id}')">${heart(isFav(m.id))}</button>
          </div>`;
        grid.appendChild(el);
      });
    }
    $('#groupSel')?.addEventListener('change', renderMembers);
    $('#search')?.addEventListener('input', renderMembers);
    $('#onlyFav')?.addEventListener('change', renderMembers);

    /* ---------- FAVORITES ---------- */
    function renderFav(){
      const wrap = $('#favWrap'); wrap.innerHTML='';
      const list = MEMBERS.filter(m=>favorites.includes(m.id));
      if(!list.length){ wrap.innerHTML = '<p class="muted">ì•„ì§ ìµœì• ê°€ ì—†ìŠµë‹ˆë‹¤. ë©¤ë²„ ì¹´ë“œì—ì„œ ğŸ’–ì„ ëˆŒëŸ¬ ì¶”ê°€í•˜ì„¸ìš”.</p>'; return; }
      list.forEach(m=>{
        const el = document.createElement('div'); el.className='card';
        el.innerHTML = `
          <div class="row">
            <strong>${m.name}</strong>
            <span class="pill">${m.group==='STELLIVE'?'ST':'IS'}</span>
          </div>
          <div class="muted" style="margin:6px 0">#${(m.tags||[]).join(' #')}</div>
          <div class="row">
            <a class="btn primary" href="${m.stream}" target="_blank" rel="noopener">ì±„ë„ ë°©ë¬¸</a>
            <button class="btn" onclick="openCover('${m.id}')">ì»¤ë²„ê³¡</button>
            <button class="btn" onclick="toggleFav('${m.id}')">${heart(isFav(m.id))}</button>
          </div>`;
        wrap.appendChild(el);
      });
    }

    /* ---------- COVER ---------- */
    function populateCoverSel(){
      const sel = $('#coverSel'); sel.innerHTML='';
      MEMBERS.forEach(m=>{
        const has = PLAYLISTS.find(p=>p.member===m.id);
        if(!has) return;
        const op = document.createElement('option');
        op.value = m.id; op.textContent = `${m.group==='STELLIVE'?'[ST]':'[IS]'} ${m.name}`;
        sel.appendChild(op);
      });
      if(sel.options.length && !sel.value) sel.value = sel.options[0].value;
    }
    function renderCover(){
      const id = $('#coverSel').value;
      const pl = PLAYLISTS.find(p=>p.member===id);
      const wrap = $('#coverWrap'); wrap.innerHTML='';
      if(!pl){ wrap.innerHTML='<p class="muted">ì¬ìƒëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
      const ifr = document.createElement('iframe');
      ifr.width='100%'; ifr.style.aspectRatio='16/9'; ifr.loading='lazy';
      ifr.src = pl.url; ifr.allowFullscreen = true; ifr.frameBorder = '0';
      wrap.appendChild(ifr);
      const cap = document.createElement('div'); cap.className='muted'; cap.style.marginTop='6px';
      cap.textContent = pl.label + ' ì»¤ë²„ ì¬ìƒëª©ë¡';
      wrap.appendChild(cap);
    }
    $('#coverSel')?.addEventListener('change', renderCover);
    function openCover(id){ switchTab('cover'); $('#coverSel').value=id; renderCover(); }

    /* ---------- FANART ---------- */
    function renderFanartUI(){
      const gm = $('#fanMember');
      const group = $('#fanGroup').value;
      gm.innerHTML='';
      MEMBERS.filter(m=>m.group===(group)).forEach(m=>{
        const op=document.createElement('option'); op.value=m.id; op.textContent=m.name; gm.appendChild(op);
      });
      loadFanart();
    }
    $('#fanGroup').addEventListener('change', renderFanartUI);
    $('#fanMember').addEventListener('change', loadFanart);
    $('#reloadFan').addEventListener('click', loadFanart);

    function tagFor(memberId){
      const m = MEMBERS.find(x=>x.id===memberId);
      if(!m) return 'art';
      return (m.tags?.[0]) || 'art';
    }
    function today(){ const d=new Date(); return d.toISOString().slice(0,10); }

    async function loadFanart(){
      const memberId = $('#fanMember').value;
      const tag = tagFor(memberId);
      const gallery = $('#fanGallery'); gallery.innerHTML='';
      const proxy = (localStorage.getItem(KEY.config)? JSON.parse(localStorage.getItem(KEY.config)).xProxyBase : APP.xProxyBase) || '';

      // ê³ ì • ì´ë¯¸ì§€(ì˜¤ëŠ˜)
      const pkey = KEY.galleryPin(tag, today());
      const pin = JSON.parse(localStorage.getItem(pkey)||'null');
      if(pin){
        const fig=document.createElement('figure');
        fig.innerHTML = `<img src="${pin.img}" alt="pinned"><figcaption class="muted">${tag} â€¢ ê´€ë¦¬ì ê³ ì • <a href="${pin.src||'#'}" target="_blank">ì›ë³¸</a></figcaption>`;
        gallery.appendChild(fig);
      }

      if(proxy){
        // í”„ë¡ì‹œê°€ ìˆë‹¤ë©´ í”„ë¡ì‹œì—ì„œ ìµœì‹  ì´ë¯¸ì§€ 10ì¥ ì¤‘ 3ì¥
        try{
          const res = await fetch(`${proxy}/hashtag/${encodeURIComponent(tag)}?limit=10`);
          const data = await res.json(); // [{img,src},...]
          const picks = data.slice(0,10).sort(()=>Math.random()-0.5).slice(0,3);
          picks.forEach(it=>{
            const fig=document.createElement('figure');
            fig.innerHTML = `<a href="${it.src}" target="_blank"><img src="${it.img}" alt="${tag}"></a>`;
            gallery.appendChild(fig);
          });
        }catch(e){
          gallery.innerHTML += `<p class="muted">í”„ë¡ì‹œ ìš”ì²­ ì‹¤íŒ¨. í•´ì‹œíƒœê·¸ íƒ€ì„ë¼ì¸ë¡œ ì´ë™í•˜ì„¸ìš”.</p>`;
          gallery.appendChild(tagLink(tag));
        }
      }else{
        // í”„ë¡ì‹œ ì—†ìœ¼ë©´ ë§í¬ë§Œ
        gallery.appendChild(tagLink(tag));
      }
    }
    function tagLink(tag){
      const wrap=document.createElement('div');
      wrap.innerHTML = `<a class="btn" href="https://x.com/hashtag/${encodeURIComponent(tag)}" target="_blank">#${tag} íƒ€ì„ë¼ì¸ ì—´ê¸°</a>`;
      return wrap;
    }
    // ê´€ë¦¬ì íŒ¨ë„ ë™ì‘
    $('#adminToggle').addEventListener('click', ()=>$('#adminPanel').classList.toggle('hide'));
    $('#saveProxy').addEventListener('click', ()=>{
      const v = $('#xProxy').value.trim();
      const cfg = JSON.parse(localStorage.getItem(KEY.config)||'{}'); cfg.xProxyBase = v;
      localStorage.setItem(KEY.config, JSON.stringify(cfg));
      alert('ì €ì¥ë¨. ê°¤ëŸ¬ë¦¬ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.');
    });
    $('#savePin').addEventListener('click', ()=>{
      const memberId = $('#fanMember').value;
      const tag = tagFor(memberId);
      const img = $('#pinImage').value.trim();
      const src = $('#pinLink').value.trim();
      localStorage.setItem(KEY.galleryPin(tag, today()), JSON.stringify({img,src}));
      loadFanart();
    });
    $('#clearPin').addEventListener('click', ()=>{
      const memberId = $('#fanMember').value; const tag = tagFor(memberId);
      localStorage.removeItem(KEY.galleryPin(tag, today()));
      loadFanart();
    });
    $('#useUpload').addEventListener('click', ()=>{
      const file = $('#uploadImg').files?.[0]; if(!file) return alert('ì´ë¯¸ì§€ ì„ íƒ');
      const reader = new FileReader();
      reader.onload = ()=>{
        const gallery=$('#fanGallery'); const fig=document.createElement('figure');
        fig.innerHTML = `<img src="${reader.result}" alt="upload"><figcaption class="muted">ìˆ˜ë™ ì—…ë¡œë“œ(ë¡œì»¬ ì €ì¥)</figcaption>`;
        gallery.prepend(fig);
      };
      reader.readAsDataURL(file);
    });
    $('#addTweet').addEventListener('click', ()=>{
      const url = $('#tweetUrl').value.trim(); if(!url) return;
      const div = document.createElement('div');
      div.innerHTML = `<blockquote class="twitter-tweet"><a href="${url}"></a></blockquote>`;
      $('#fanGallery').prepend(div);
      // Load widget script one-time
      if(!window.__twLoaded){
        const s=document.createElement('script'); s.src='https://platform.twitter.com/widgets.js'; s.async=true;
        document.body.appendChild(s); window.__twLoaded=true;
      }else if(window.twttr?.widgets){ window.twttr.widgets.load(); }
    });

    /* ---------- DIARY / CONFESS ---------- */
    function renderList(key, elId){
      const items = JSON.parse(localStorage.getItem(key)||'[]');
      const ul=$(elId); ul.innerHTML='';
      items.forEach((t,idx)=>{
        const li=document.createElement('li');
        li.innerHTML = `<span>${t.text}</span><button class="btn" data-idx="${idx}">ì‚­ì œ</button>`;
        ul.appendChild(li);
      });
      ul.querySelectorAll('button').forEach(btn=>btn.addEventListener('click',e=>{
        const idx=+e.currentTarget.dataset.idx;
        const arr=JSON.parse(localStorage.getItem(key)||'[]'); arr.splice(idx,1);
        localStorage.setItem(key, JSON.stringify(arr));
        renderList(key, elId);
      }));
    }
    $('#addDiary').addEventListener('click', ()=>{
      const v=$('#diaryText').value.trim(); if(!v) return;
      const arr=JSON.parse(localStorage.getItem(KEY.diary)||'[]'); arr.unshift({text:v,ts:Date.now()});
      localStorage.setItem(KEY.diary, JSON.stringify(arr)); $('#diaryText').value=''; renderDiary();
    });
    function renderDiary(){ renderList(KEY.diary, '#diaryList'); }
    $('#addConf').addEventListener('click', ()=>{
      const v=$('#confText').value.trim(); if(!v) return;
      const arr=JSON.parse(localStorage.getItem(KEY.confess)||'[]'); arr.unshift({text:v,ts:Date.now()});
      localStorage.setItem(KEY.confess, JSON.stringify(arr)); $('#confText').value=''; renderConf();
    });
    function renderConf(){ renderList(KEY.confess, '#confList'); }

    /* ---------- VOTE ---------- */
    function ym(){ const d=new Date(); return d.toISOString().slice(0,7); } // YYYY-MM
    function populateVoteSel(){
      const scope=$('#voteScope').value;
      const sel=$('#voteSel'); sel.innerHTML='';
      let list = MEMBERS.slice();
      if(scope!=='ALL') list = list.filter(m=>m.group===scope);
      list.forEach(m=>{
        const op=document.createElement('option'); op.value=m.id; op.textContent=`${m.group==='STELLIVE'?'[ST]':'[IS]'} ${m.name}`;
        sel.appendChild(op);
      });
    }
    $('#voteScope').addEventListener('change', ()=>{ populateVoteSel(); renderVoteChart(); });
    $('#doVote').addEventListener('click', ()=>{
      const id=$('#voteSel').value; const key=KEY.vote(ym());
      const state=JSON.parse(localStorage.getItem(key)||'{"voted":false,"counts":{}}');
      if(state.voted){ alert('ì´ë²ˆ ë‹¬ì€ ì´ë¯¸ íˆ¬í‘œí–ˆìŠµë‹ˆë‹¤.'); return; }
      state.voted=true; state.counts[id]=(state.counts[id]||0)+1;
      localStorage.setItem(key, JSON.stringify(state));
      renderVoteChart();
      alert('íˆ¬í‘œ ì™„ë£Œ!');
    });
    $('#myVote').addEventListener('click', ()=>{
      const state=JSON.parse(localStorage.getItem(KEY.vote(ym()))||'{"voted":false}');
      alert(state.voted?'ì´ë²ˆ ë‹¬ íˆ¬í‘œ ì™„ë£Œ ìƒíƒœì…ë‹ˆë‹¤.':'ì•„ì§ íˆ¬í‘œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    });
    let voteChart=null;
    function renderVoteChart(){
      const key=KEY.vote(ym()); const state=JSON.parse(localStorage.getItem(key)||'{"counts":{}}');
      const counts=state.counts||{};
      const labels=MEMBERS.map(m=>m.name);
      const data=MEMBERS.map(m=>counts[m.id]||0);
      const ctx=$('#voteChart').getContext('2d');
      if(voteChart) voteChart.destroy();
      voteChart = new Chart(ctx, {
        type:'bar',
        data:{ labels, datasets:[{ label:'ë“í‘œìˆ˜', data }] },
        options:{ scales:{ y:{ beginAtZero:true } } }
      });
    }

    /* ---------- INIT ---------- */
    function boot(){
      loadConfig();
      switchTab((location.hash||'#home').slice(1) || 'home');
    }
    boot();
  </script>
</body>
</html>
